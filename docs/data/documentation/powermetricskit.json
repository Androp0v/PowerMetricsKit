{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"text":"Overview","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This package uses "},{"type":"codeVoice","code":"libproc"},{"type":"text","text":"‘s "},{"type":"codeVoice","code":"proc_pidinfo"},{"type":"text","text":" with the "},{"type":"codeVoice","code":"PROC_PIDTHREADCOUNTS"},{"type":"text","text":" option, which returns a "},{"type":"codeVoice","code":"struct"},{"type":"text","text":" including per-thread energy measurements from the CPU’s’ Closed Loop Performance Controller (CLPC), which in turn obtains the energy results from the Digital Power Estimator (DPE)."},{"text":" ","type":"text"},{"text":"The list of all threads is retrieved using ","type":"text"},{"type":"codeVoice","code":"task_threads"},{"type":"text","text":" with the PID of the current task (root privileges are required to invoke "},{"type":"codeVoice","code":"task_threads"},{"text":" on other processes).","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"code":"libproc.h","type":"codeVoice"},{"type":"text","text":" headers can’t be imported on iOS, so they’re reproduced at the beginning of "},{"type":"codeVoice","code":"sample_threads.c"},{"text":", as well as the result ","type":"text"},{"code":"struct","type":"codeVoice"},{"text":"s from the ","type":"text"},{"type":"codeVoice","code":"proc_pidinfo"},{"type":"text","text":", using the definitions and documentation available in "},{"type":"reference","identifier":"https:\/\/github.com\/apple-oss-distributions\/xnu\/blob\/aca3beaa3dfbd42498b42c5e5ce20a938e6554e5\/bsd\/sys\/proc_info.h","isActive":true},{"text":".","type":"text"}]}]}],"hierarchy":{"paths":[[]]},"topicSections":[{"generated":true,"title":"Articles","identifiers":["doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Adding-power-metrics-to-your-app","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/TestAppPower","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Unwinding-the-stack"]},{"title":"Classes","identifiers":["doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceGraph","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceInfo","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CPUUsageManager","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/RingBuffer","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsActor","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsManager","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampledResultsHistory","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SymbolicateBacktraces"]},{"identifiers":["doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Backtrace","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CPUUsage","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CombinedPower","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CoreUsage","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/PowerMetricsConfig","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/PowerWidgetView","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsResult","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SimpleBacktraceInfo","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SymbolicatedInfo","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/ThreadSample"],"title":"Structures"},{"identifiers":["doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceAddress","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Energy","doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Power"],"title":"Type Aliases"}],"kind":"symbol","metadata":{"roleHeading":"Framework","title":"PowerMetricsKit","role":"collection","externalID":"PowerMetricsKit","modules":[{"name":"PowerMetricsKit"}],"symbolKind":"module"},"schemaVersion":{"major":0,"patch":0,"minor":3},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/powermetricskit"]}],"sections":[],"identifier":{"url":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"A package to retrieve realtime information on CPU energy consumption using the CPU’s Closed Loop Performance Controller (CLPC) via "},{"type":"codeVoice","code":"proc_pidinfo"},{"text":".","type":"text"}],"references":{"doc://PowerMetricsKit/documentation/PowerMetricsKit/RingBuffer":{"title":"RingBuffer","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/RingBuffer","role":"symbol","abstract":[{"text":"A ring buffer.","type":"text"}],"url":"\/documentation\/powermetricskit\/ringbuffer","kind":"symbol","navigatorTitle":[{"text":"RingBuffer","kind":"identifier"}],"fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"text":"RingBuffer","kind":"identifier"}]},"https://github.com/apple-oss-distributions/xnu/blob/aca3beaa3dfbd42498b42c5e5ce20a938e6554e5/bsd/sys/proc_info.h":{"type":"link","titleInlineContent":[{"type":"text","text":"Apple’s OSS Distributions repository for "},{"type":"codeVoice","code":"libproc.h"}],"url":"https:\/\/github.com\/apple-oss-distributions\/xnu\/blob\/aca3beaa3dfbd42498b42c5e5ce20a938e6554e5\/bsd\/sys\/proc_info.h","identifier":"https:\/\/github.com\/apple-oss-distributions\/xnu\/blob\/aca3beaa3dfbd42498b42c5e5ce20a938e6554e5\/bsd\/sys\/proc_info.h","title":"Apple’s OSS Distributions repository for libproc.h"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/PowerMetricsConfig":{"title":"PowerMetricsConfig","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/PowerMetricsConfig","role":"symbol","abstract":[{"type":"text","text":"The configuration of the thread sampling."}],"url":"\/documentation\/powermetricskit\/powermetricsconfig","kind":"symbol","navigatorTitle":[{"text":"PowerMetricsConfig","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"PowerMetricsConfig","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SymbolicateBacktraces":{"title":"SymbolicateBacktraces","url":"\/documentation\/powermetricskit\/symbolicatebacktraces","fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"SymbolicateBacktraces"}],"navigatorTitle":[{"text":"SymbolicateBacktraces","kind":"identifier"}],"role":"symbol","kind":"symbol","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SymbolicateBacktraces","type":"topic","abstract":[{"type":"text","text":"A class to interact to "},{"type":"codeVoice","code":"dladdr"},{"text":" to retrieve information about the sampled backtraces.","type":"text"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SampleThreadsManager":{"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsManager","title":"SampleThreadsManager","kind":"symbol","type":"topic","abstract":[{"text":"The main class interfacing with the C code that retrieves the energy data.","type":"text"}],"url":"\/documentation\/powermetricskit\/samplethreadsmanager","navigatorTitle":[{"text":"SampleThreadsManager","kind":"identifier"}],"role":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SampleThreadsManager","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/CPUUsage":{"title":"CPUUsage","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CPUUsage","role":"symbol","abstract":[{"text":"The information about the CPU usage at a given point in time, broken down by core.","type":"text"}],"url":"\/documentation\/powermetricskit\/cpuusage","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"CPUUsage"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"CPUUsage","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/BacktraceGraph":{"title":"BacktraceGraph","role":"symbol","abstract":[{"text":"A graph containing the recorded backtrace information.","type":"text"}],"navigatorTitle":[{"kind":"identifier","text":"BacktraceGraph"}],"type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceGraph","kind":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"BacktraceGraph","kind":"identifier"}],"url":"\/documentation\/powermetricskit\/backtracegraph"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/CPUUsageManager":{"title":"CPUUsageManager","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CPUUsageManager","role":"symbol","abstract":[{"text":"Class used to retrieve the usage (occupancy) of each CPU core.","type":"text"}],"url":"\/documentation\/powermetricskit\/cpuusagemanager","kind":"symbol","navigatorTitle":[{"text":"CPUUsageManager","kind":"identifier"}],"fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"CPUUsageManager"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SimpleBacktraceInfo":{"title":"SimpleBacktraceInfo","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SimpleBacktraceInfo","role":"symbol","abstract":[{"type":"text","text":"Minimal piece of information of a backtrace address."}],"url":"\/documentation\/powermetricskit\/simplebacktraceinfo","kind":"symbol","navigatorTitle":[{"text":"SimpleBacktraceInfo","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SimpleBacktraceInfo","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SymbolicatedInfo":{"kind":"symbol","abstract":[{"type":"text","text":"Symbol information of a backtrace, recovered using "},{"code":"dladdr","type":"codeVoice"},{"text":".","type":"text"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SymbolicatedInfo","role":"symbol","url":"\/documentation\/powermetricskit\/symbolicatedinfo","navigatorTitle":[{"kind":"identifier","text":"SymbolicatedInfo"}],"type":"topic","title":"SymbolicatedInfo","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SymbolicatedInfo","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/Power":{"url":"\/documentation\/powermetricskit\/power","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Power","role":"symbol","abstract":[{"text":"A power measurement, always in watts.","type":"text"}],"navigatorTitle":[{"text":"Power","kind":"identifier"}],"type":"topic","fragments":[{"text":"typealias","kind":"keyword"},{"kind":"text","text":" "},{"text":"Power","kind":"identifier"}],"title":"Power","kind":"symbol"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/CombinedPower":{"kind":"symbol","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CombinedPower","role":"symbol","abstract":[{"text":"A combined power measurement composed of measurements for different core types.","type":"text"}],"navigatorTitle":[{"text":"CombinedPower","kind":"identifier"}],"type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"CombinedPower","kind":"identifier"}],"title":"CombinedPower","url":"\/documentation\/powermetricskit\/combinedpower"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/BacktraceAddress":{"type":"topic","fragments":[{"text":"typealias","kind":"keyword"},{"kind":"text","text":" "},{"text":"BacktraceAddress","kind":"identifier"}],"navigatorTitle":[{"text":"BacktraceAddress","kind":"identifier"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceAddress","title":"BacktraceAddress","abstract":[{"text":"The memory address retrieved when unwinding the stack during a backtrace.","type":"text"}],"kind":"symbol","url":"\/documentation\/powermetricskit\/backtraceaddress","role":"symbol"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/ThreadSample":{"abstract":[{"type":"text","text":"The information retrieved when sampling a thread, including the power used."}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"ThreadSample","kind":"identifier"}],"kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"ThreadSample"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/ThreadSample","title":"ThreadSample","type":"topic","role":"symbol","url":"\/documentation\/powermetricskit\/threadsample"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SampledResultsHistory":{"title":"SampledResultsHistory","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampledResultsHistory","role":"symbol","abstract":[{"text":"Historic power figures for the app.","type":"text"}],"url":"\/documentation\/powermetricskit\/sampledresultshistory","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"SampledResultsHistory"}],"fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SampledResultsHistory","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/Adding-power-metrics-to-your-app":{"title":"Adding power metrics to your app","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Adding-power-metrics-to-your-app","role":"article","abstract":[{"text":"Measure energy used by your app.","type":"text"}],"url":"\/documentation\/powermetricskit\/adding-power-metrics-to-your-app","kind":"article"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/BacktraceInfo":{"kind":"symbol","abstract":[{"type":"text","text":"Full backtrace information."}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/BacktraceInfo","role":"symbol","url":"\/documentation\/powermetricskit\/backtraceinfo","navigatorTitle":[{"text":"BacktraceInfo","kind":"identifier"}],"type":"topic","title":"BacktraceInfo","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"BacktraceInfo"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/Unwinding-the-stack":{"title":"Deep Dive: Unwinding the stack","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Unwinding-the-stack","role":"article","abstract":[{"text":"Get to know how the code to obtain the backtraces for all the threads in the process works.","type":"text"}],"url":"\/documentation\/powermetricskit\/unwinding-the-stack","kind":"article"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/PowerWidgetView":{"abstract":[{"text":"A ","type":"text"},{"type":"codeVoice","code":"View"},{"text":" displaying the power consumption of the app.","type":"text"}],"title":"PowerWidgetView","navigatorTitle":[{"text":"PowerWidgetView","kind":"identifier"}],"type":"topic","role":"symbol","kind":"symbol","url":"\/documentation\/powermetricskit\/powerwidgetview","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"text":"PowerWidgetView","kind":"identifier"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/PowerWidgetView"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SampleThreadsResult":{"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SampleThreadsResult","kind":"identifier"}],"navigatorTitle":[{"text":"SampleThreadsResult","kind":"identifier"}],"type":"topic","url":"\/documentation\/powermetricskit\/samplethreadsresult","title":"SampleThreadsResult","kind":"symbol","abstract":[{"text":"The processed results from sampling the threads.","type":"text"}],"role":"symbol","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsResult"},"doc://PowerMetricsKit/documentation/PowerMetricsKit":{"type":"topic","kind":"symbol","abstract":[{"type":"text","text":"A package to retrieve realtime information on CPU energy consumption using the CPU’s Closed Loop Performance Controller (CLPC) via "},{"type":"codeVoice","code":"proc_pidinfo"},{"text":".","type":"text"}],"url":"\/documentation\/powermetricskit","title":"PowerMetricsKit","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit","role":"collection"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/Energy":{"title":"Energy","type":"topic","kind":"symbol","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Energy","abstract":[{"text":"An energy measurement, always in watts-hour.","type":"text"}],"url":"\/documentation\/powermetricskit\/energy","navigatorTitle":[{"text":"Energy","kind":"identifier"}],"role":"symbol","fragments":[{"text":"typealias","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Energy","kind":"identifier"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/Backtrace":{"title":"Backtrace","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/Backtrace","role":"symbol","abstract":[{"text":"The full backtrace and the energy usage associated with it.","type":"text"}],"url":"\/documentation\/powermetricskit\/backtrace","kind":"symbol","navigatorTitle":[{"text":"Backtrace","kind":"identifier"}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"Backtrace"}]},"doc://PowerMetricsKit/documentation/PowerMetricsKit/SampleThreadsActor":{"type":"topic","title":"SampleThreadsActor","url":"\/documentation\/powermetricskit\/samplethreadsactor","kind":"symbol","abstract":[{"text":"The global actor used to access the ","type":"text"},{"type":"codeVoice","code":"SampleThreadsManager"},{"text":" in a thread-safe way.","type":"text"}],"fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"SampleThreadsActor"}],"navigatorTitle":[{"kind":"identifier","text":"SampleThreadsActor"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/SampleThreadsActor","role":"symbol"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/TestAppPower":{"title":"TestAppPower: Integrating PowerMetricsKit into a sample app","type":"topic","identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/TestAppPower","role":"sampleCode","abstract":[{"type":"text","text":"Integrate PowerMetricsKit into a sample SwiftUI app."}],"url":"\/documentation\/powermetricskit\/testapppower","kind":"article"},"doc://PowerMetricsKit/documentation/PowerMetricsKit/CoreUsage":{"type":"topic","kind":"symbol","title":"CoreUsage","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"CoreUsage","kind":"identifier"}],"identifier":"doc:\/\/PowerMetricsKit\/documentation\/PowerMetricsKit\/CoreUsage","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"CoreUsage"}],"url":"\/documentation\/powermetricskit\/coreusage","abstract":[{"type":"text","text":"The usage (occupancy) of a single core."}]}}}